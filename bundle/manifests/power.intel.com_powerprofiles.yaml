apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.18.0
  creationTimestamp: null
  name: powerprofiles.power.intel.com
spec:
  group: power.intel.com
  names:
    kind: PowerProfile
    listKind: PowerProfileList
    plural: powerprofiles
    singular: powerprofile
  scope: Namespaced
  versions:
  - name: v1
    schema:
      openAPIV3Schema:
        description: PowerProfile is the Schema for the powerprofiles API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: PowerProfileSpec defines the desired state of PowerProfile
            properties:
              cpuCapacity:
                anyOf:
                - type: integer
                - type: string
                default: 100%
                description: |-
                  CpuCapacity defines the number or percentage of CPUs that can be allocated to this profile.
                  If not specified, it defaults to 100% of the available CPUs.
                  Accepted values are:
                  - A number (e.g., 5)
                  - A percentage (e.g., "10%")
                pattern: ^([1-9][0-9]?|100)%?$
                x-kubernetes-int-or-string: true
              cpuScalingPolicy:
                description: CPU scaling policy
                properties:
                  allowedFrequencyDifference:
                    default: 25
                    description: |-
                      Maximum difference between target and actual CPU frequency on which
                      frequency re-evaluation will not happen, in MHz
                    minimum: 0
                    type: integer
                  allowedUsageDifference:
                    default: 5
                    description: |-
                      Maximum difference between target and actual CPU usage on which
                      frequency re-evaluation will not happen, in percent points
                    maximum: 50
                    minimum: 0
                    type: integer
                  cooldownPeriod:
                    default: 30ms
                    description: Time to elapse after setting a new frequency target
                      before next scaling control.
                    format: duration
                    type: string
                  fallbackFreqPercent:
                    default: 0
                    description: Frequency to set when CPU usage is not available,
                      in percent of max frequency
                    maximum: 100
                    minimum: 0
                    type: integer
                  samplePeriod:
                    default: 10ms
                    description: |-
                      Time to elapse between two CPU sampling periods for scaling control.
                      At each sampling period the scaler reads CPU usage and adjusts frequency if needed.
                    format: duration
                    type: string
                  scalePercentage:
                    default: 50
                    description: Percentage factor of CPU frequency change when scaling
                    maximum: 200
                    minimum: 10
                    type: integer
                  targetUsage:
                    default: 80
                    description: Target CPU usage, in percent
                    maximum: 100
                    minimum: 0
                    type: integer
                  workloadType:
                    default: polling-dpdk
                    description: Workload type
                    enum:
                    - polling-dpdk
                    type: string
                type: object
                x-kubernetes-validations:
                - message: samplePeriod must be between 10ms and 1s
                  rule: duration(self.samplePeriod).getMilliseconds() >= 10 && duration(self.samplePeriod).getMilliseconds()
                    <= 1000
                - message: cooldownPeriod must be larger than samplePeriod
                  rule: duration(self.cooldownPeriod).getMilliseconds() >= duration(self.samplePeriod).getMilliseconds()
              cstates:
                description: C-states configuration
                properties:
                  maxLatencyUs:
                    description: |-
                      MaxLatencyUs defines the maximum latency threshold in microseconds.
                      C-states with latency higher than this threshold will be disabled.
                      This field is mutually exclusive with 'names' — only one of 'names' or 'maxLatencyUs' may be set.
                    minimum: 0
                    type: integer
                  names:
                    additionalProperties:
                      type: boolean
                    description: |-
                      Names defines explicit C-state configuration.
                      The map key represents the C-state name (e.g., "C1", "C1E", "C6" etc.).
                      The map value represents whether the C-state should be enabled (true) or disabled (false).
                      This field is mutually exclusive with 'maxLatencyUs' — only one of 'names' or 'maxLatencyUs' may be set.
                    type: object
                type: object
                x-kubernetes-validations:
                - message: Specify either 'names' or 'maxLatencyUs' for C-state configuration,
                    but not both
                  rule: '!(has(self.names) && has(self.maxLatencyUs))'
              name:
                description: The name of the PowerProfile
                type: string
              nodeSelector:
                description: |-
                  NodeSelector specifies which nodes this PowerProfile should be applied to
                  If empty, the profile will be applied to all the nodes.
                properties:
                  labelSelector:
                    description: |-
                      LabelSelector is a label selector that specifies which nodes this PowerProfile should be
                      applied to.
                    properties:
                      matchExpressions:
                        description: matchExpressions is a list of label selector
                          requirements. The requirements are ANDed.
                        items:
                          description: |-
                            A label selector requirement is a selector that contains values, a key, and an operator that
                            relates the key and values.
                          properties:
                            key:
                              description: key is the label key that the selector
                                applies to.
                              type: string
                            operator:
                              description: |-
                                operator represents a key's relationship to a set of values.
                                Valid operators are In, NotIn, Exists and DoesNotExist.
                              type: string
                            values:
                              description: |-
                                values is an array of string values. If the operator is In or NotIn,
                                the values array must be non-empty. If the operator is Exists or DoesNotExist,
                                the values array must be empty. This array is replaced during a strategic
                                merge patch.
                              items:
                                type: string
                              type: array
                              x-kubernetes-list-type: atomic
                          required:
                          - key
                          - operator
                          type: object
                        type: array
                        x-kubernetes-list-type: atomic
                      matchLabels:
                        additionalProperties:
                          type: string
                        description: |-
                          matchLabels is a map of {key,value} pairs. A single {key,value} in the matchLabels
                          map is equivalent to an element of matchExpressions, whose key field is "key", the
                          operator is "In", and the values array contains only "value". The requirements are ANDed.
                        type: object
                    type: object
                    x-kubernetes-map-type: atomic
                type: object
              pstates:
                description: P-states configuration
                properties:
                  epp:
                    description: The priority value associated with this Power Profile
                    type: string
                  governor:
                    default: powersave
                    description: Governor to be used
                    type: string
                  max:
                    anyOf:
                    - type: integer
                    - type: string
                    description: |-
                      Max frequency cores can run at. If not specified, it defaults to the maximum frequency of the CPU.
                      If specified as a percentage, the following formula is used: min + (max - min) * percentage.
                    pattern: ^(\d+|([1-9]?\d|100)%)$
                    x-kubernetes-int-or-string: true
                  min:
                    anyOf:
                    - type: integer
                    - type: string
                    description: |-
                      Min frequency cores can run at. If not specified, it defaults to the minimum frequency of the CPU.
                      If specified as a percentage, the following formula is used: min + (max - min) * percentage.
                    pattern: ^(\d+|([1-9]?\d|100)%)$
                    x-kubernetes-int-or-string: true
                type: object
              shared:
                type: boolean
            required:
            - name
            type: object
            x-kubernetes-validations:
            - message: pstates.governor must be 'userspace' when cpuScalingPolicy
                is set
              rule: '!has(self.cpuScalingPolicy) || (has(self.pstates.governor) &&
                self.pstates.governor == ''userspace'')'
          status:
            description: PowerProfileStatus defines the observed state of PowerProfile
            properties:
              errors:
                items:
                  type: string
                type: array
              id:
                description: The ID given to the power profile
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: null
  storedVersions: null
